const mediaQuerySmall = window.matchMedia("(min-width: 1000px)");
let pokemonRepository = (function () {
  let e = [],
    t = "https://pokeapi.co/api/v2/pokemon/?limit=150";
  function n(t) {
    e.push(t);
  }
  async function o(e) {
    let t = e.detailsUrl;
    try {
      const n = await fetch(t),
        o = await n.json();
      (e.imageUrl = o.sprites.other.dream_world.front_default),
        (e.height = o.height),
        (e.types = o.types),
        (e.weight = o.weight);
    } catch (e) {
      console.error(e);
    }
  }
  return {
    loadList: async function () {
      try {
        const e = await fetch(t);
        (await e.json()).results.forEach(function (e) {
          n({ name: e.name, detailsUrl: e.url });
        });
      } catch (e) {
        console.error(e);
      }
    },
    getAll: function () {
      return e;
    },
    add: n,
    loadDetails: o,
    addListItem: function (e) {
      let t,
        n = document.getElementById("pokemon-list"),
        i = document.createElement("button");
      function l(e) {
        t = !e.matches;
      }
      i.classList.add("pokemon-card"),
        (i.innerText = `${e.name[0].toUpperCase()}${e.name
          .slice(1)
          .toLowerCase()}`),
        l(mediaQuerySmall),
        mediaQuerySmall.addEventListener("change", l),
        n.appendChild(i),
        i.addEventListener("click", function () {
          t
            ? (function (e) {
                let t = document.getElementById("close"),
                  n = document.getElementById("modal"),
                  i = document.getElementById("modal-title"),
                  l = document.getElementById("modal-height"),
                  a = document.getElementById("modal-weight"),
                  d = document.getElementById("modal-img");
                (n.style.display = "block"),
                  o(e).then(function () {
                    console.log(e),
                      console.log("Modal stuff"),
                      (l.innerText = `Height: ${10 * e.height} cm`),
                      (a.innerText = `Weight: ${e.weight / 10} kg`),
                      (d.src = e.imageUrl),
                      (d.alt = `Image of ${e.name}`),
                      (i.innerText = `${e.name[0].toUpperCase()}${e.name
                        .slice(1)
                        .toLowerCase()}`);
                  }),
                  t.addEventListener("click", function () {
                    n.style.display = "none";
                  }),
                  (window.onclick = function (e) {
                    e.target == n && (n.style.display = "none");
                  }),
                  window.addEventListener("keydown", function (e) {
                    "Escape" === e.key &&
                      "block" === n.style.display &&
                      (n.style.display = "none");
                  });
              })(e)
            : (function (e) {
                let t = document.getElementById("detail-title"),
                  n = document.getElementById("detail-img"),
                  i = document.getElementById("detail-height"),
                  l = document.getElementById("detail-weight");
                o(e).then(function () {
                  console.log("normal stuff"),
                    (t.innerText = `${e.name[0].toUpperCase()}${e.name
                      .slice(1)
                      .toLowerCase()}`),
                    (i.innerText = `Height: ${10 * e.height} cm`),
                    (l.innerText = `Weight: ${e.weight / 10} kg`),
                    (n.style.display = "block"),
                    (n.src = e.imageUrl),
                    (n.alt = `Image of ${e.name}`);
                });
              })(e);
        });
    },
  };
})();
pokemonRepository.loadList().then(function () {
  pokemonRepository.getAll().forEach(function (e) {
    pokemonRepository.addListItem(e);
  });
});
